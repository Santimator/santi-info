{{ define "main" }}
<div class="content-shell">
  <article class="page-article">
    <header>
      <h1>{{ .Title }}</h1>
    </header>

    {{/* Intro card presents the astrological context. */}}
    <section class="intro-card">
      {{ .Content }}
    </section>

    {{/* Enneagram Section */}}
    {{ $enneagramData := .Site.Data.astrology.enneagram }}
    {{ if $enneagramData }}
    <section class="cv-section">
      <div class="cv-inner">
        <header class="cv-section-header">
          <h2>Enneagram</h2>
        </header>
        <div class="cv-cards">
          {{ if $enneagramData.profile }}
          <div class="cv-card">
            <h3>Type {{ $enneagramData.profile.type }}{{ if $enneagramData.profile.wing }} - Wing {{ $enneagramData.profile.wing }}{{ end }}</h3>
            {{ if $enneagramData.profile.description }}
            <p>{{ $enneagramData.profile.description }}</p>
            {{ end }}
          </div>
          {{ end }}
          {{ range $enneagramData.traits }}
          <div class="cv-card">
            <h3>{{ .trait }}</h3>
            <p>{{ .description }}</p>
          </div>
          {{ end }}
        </div>
      </div>
    </section>
    {{ end }}

    {{/* Western Astrology Section */}}
    {{ $westernData := .Site.Data.astrology.western }}
    {{ if $westernData }}
    <section class="cv-section">
      <div class="cv-inner">
        <header class="cv-section-header">
          <h2>Western Astrology</h2>
        </header>

        {{/* Summary - starts directly with strengths */}}
        <div class="astro-summary">
          {{/* Strengths section */}}
          {{ if $westernData.strengths }}
          <div class="astro-strengths">
            <h3>{{ $westernData.strengths.title }}</h3>
            {{ range $westernData.strengths.items }}
            <div class="strength-item">
              <h4>{{ .name }}</h4>
              <p>{{ .description }}</p>
            </div>
            {{ end }}
          </div>
          {{ end }}

          {{/* Trajectory */}}
          {{ if $westernData.trajectory }}
          <div class="astro-trajectory">
            <p><strong>Overall trajectory:</strong> {{ $westernData.trajectory.summary }}</p>
            <p class="trajectory-conclusion">{{ $westernData.trajectory.conclusion }}</p>
          </div>
          {{ end }}
        </div>

        {{/* Flip cards for planetary placements */}}
        {{ if $westernData.placements }}
        <div class="cv-cards astro-flip-cards">
          {{ range $westernData.placements }}
          <div class="flip-card" data-category="{{ .category }}">
            <div class="flip-card-inner">
              <div class="flip-card-front">
                <h3>{{ .planet }}{{ if .retrograde }} â„ž{{ end }}</h3>
                <p class="planet-sign">{{ .sign }}</p>
                <p class="planet-house">House {{ .house }}</p>
                <span class="flip-hint">Click to reveal</span>
              </div>
              <div class="flip-card-back">
                <h3>{{ .planet }} in {{ .sign }}</h3>
                <p class="planet-notes">{{ .notes }}</p>
                <span class="flip-hint">Click to return</span>
              </div>
            </div>
          </div>
          {{ end }}
        </div>
        {{ end }}
      </div>
    </section>
    {{ end }}

    {{/* Chinese Astrology Section */}}
    {{ $chineseData := .Site.Data.astrology.chinese }}
    {{ if $chineseData }}
    <section class="cv-section">
      <div class="cv-inner">
        <header class="cv-section-header">
          <h2>Chinese Astrology</h2>
        </header>
        {{ if $chineseData.zodiac }}
        <div class="cv-cards">
          <div class="cv-card">
            <h3>{{ $chineseData.zodiac.animal }} - {{ $chineseData.zodiac.element }}</h3>
            <h4>Year {{ $chineseData.zodiac.year }}</h4>
            {{ if $chineseData.zodiac.description }}
            <p>{{ $chineseData.zodiac.description }}</p>
            {{ end }}
          </div>
        </div>
        {{ end }}
        {{ if $chineseData.traits }}
        <div class="cv-cards">
          {{ range $chineseData.traits }}
          <div class="cv-card">
            <h3>{{ .trait }}</h3>
            <p>{{ .description }}</p>
          </div>
          {{ end }}
        </div>
        {{ end }}
      </div>
    </section>
    {{ end }}

    {{/* Links Section (if exists) */}}
    {{ partial "cards/generic.html" (dict "Page" . "key" "links") }}
  </article>
</div>
{{ end }}
