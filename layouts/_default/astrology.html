{{ define "main" }}
<div class="content-shell">
  <article class="page-article">
    <header>
      <h1>{{ .Title }}</h1>
    </header>

    {{/* Intro card presents the astrological context. */}}
    <section class="intro-card">
      {{ .Content }}
    </section>

    {{/* Enneagram Section */}}
    {{ $enneagramData := .Site.Data.astrology.enneagram }}
    {{ if $enneagramData }}
    <section class="cv-section">
      <div class="cv-inner">
        <header class="cv-section-header">
          <h2>Enneagram</h2>
        </header>

        {{/* Poem */}}
        {{ if $enneagramData.poem }}
        <div class="enneagram-poem">
          <div class="poem-text poem-stairs">
            {{ range $index, $line := split $enneagramData.poem.text "\n" }}
            <p class="poem-line" data-line="{{ $index }}">{{ $line }}</p>
            {{ end }}
          </div>
          <p class="poem-author">— {{ $enneagramData.poem.author }}</p>
        </div>
        {{ end }}

        {{/* Introduction */}}
        {{ if $enneagramData.introduction }}
        <div class="enneagram-intro">
          <h3>{{ $enneagramData.introduction.title }}</h3>
          <p>{{ $enneagramData.introduction.text }}</p>
        </div>
        {{ end }}

        {{/* Profile */}}
        {{ if $enneagramData.profile }}
        <div class="enneagram-profile">
          <h3>{{ $enneagramData.profile.title }}</h3>
          <p>{{ $enneagramData.profile.description }}</p>
        </div>
        {{ end }}
      </div>
    </section>
    {{ end }}

    {{/* Western Astrology Section */}}
    {{ $westernData := .Site.Data.astrology.western }}
    {{ if $westernData }}
    <section class="cv-section">
      <div class="cv-inner">
        <header class="cv-section-header">
          <h2>Western Astrology</h2>
        </header>

        {{/* Summary - starts directly with strengths */}}
        <div class="astro-summary">
          {{/* Strengths section */}}
          {{ if $westernData.strengths }}
          <div class="astro-strengths">
            <h3>{{ $westernData.strengths.title }}</h3>
            {{ range $westernData.strengths.items }}
            <div class="strength-item">
              <h4>{{ .name }}</h4>
              <p>{{ .description }}</p>
            </div>
            {{ end }}
          </div>
          {{ end }}

          {{/* Trajectory */}}
          {{ if $westernData.trajectory }}
          <div class="astro-trajectory">
            <p><strong>Overall trajectory:</strong> {{ $westernData.trajectory.summary }}</p>
            <p class="trajectory-conclusion">{{ $westernData.trajectory.conclusion }}</p>
          </div>
          {{ end }}
        </div>

        {{/* Flip cards for planetary placements */}}
        {{ if $westernData.placements }}
        <div class="cv-cards astro-flip-cards">
          {{ range $westernData.placements }}
          <div class="flip-card" data-category="{{ .category }}">
            <div class="flip-card-inner">
              <div class="flip-card-front">
                <h3>{{ .planet }}{{ if .retrograde }} ℞{{ end }}</h3>
                <p class="planet-sign">{{ .sign }}</p>
                <p class="planet-house">House {{ .house }}</p>
                <span class="flip-hint">Click to reveal</span>
              </div>
              <div class="flip-card-back">
                <h3>{{ .planet }} in {{ .sign }}</h3>
                <p class="planet-notes">{{ .notes }}</p>
                <span class="flip-hint">Click to return</span>
              </div>
            </div>
          </div>
          {{ end }}
        </div>
        {{ end }}
      </div>
    </section>
    {{ end }}

    {{/* Chinese Astrology Section */}}
    {{ $chineseData := .Site.Data.astrology.chinese }}
    {{ if $chineseData }}
    <section class="cv-section">
      <div class="cv-inner">
        <header class="cv-section-header">
          <h2>Chinese Astrology</h2>
        </header>

        {{/* Overview */}}
        {{ if $chineseData.overview }}
        <div class="chinese-astro-overview">
          <h3>{{ $chineseData.overview.title }}</h3>
          <p><strong>Birth Hour:</strong> {{ $chineseData.overview.birth_hour }}</p>
          <p>{{ $chineseData.overview.summary }}</p>
        </div>
        {{ end }}

        {{/* Four Pillars */}}
        {{ if $chineseData.pillars }}
        <div class="chinese-pillars">
          {{ range $chineseData.pillars }}
          <div class="chinese-pillar-card">
            <h3>{{ .name }}</h3>
            <h4>{{ .title }}</h4>
            <p>{{ .description | markdownify }}</p>
          </div>
          {{ end }}
        </div>
        {{ end }}

        {{/* Elements */}}
        {{ if $chineseData.elements }}
        <div class="chinese-elements">
          <h3>{{ $chineseData.elements.title }}</h3>
          <p><strong>Dominant:</strong> {{ $chineseData.elements.dominant }}</p>
          <p><strong>Secondary:</strong> {{ $chineseData.elements.secondary }}</p>
          <p><strong>Moderate:</strong> {{ $chineseData.elements.moderate }}</p>
          <p><strong>Present:</strong> {{ $chineseData.elements.present }}</p>
          <p><strong>Weak:</strong> {{ $chineseData.elements.weak }}</p>
          {{ if $chineseData.elements.consequences }}
          <h4>Psychological consequences:</h4>
          <ul>
            {{ range $chineseData.elements.consequences }}
            <li>{{ .trait }}</li>
            {{ end }}
          </ul>
          {{ end }}
        </div>
        {{ end }}

        {{/* Character */}}
        {{ if $chineseData.character }}
        <div class="chinese-character">
          <h3>{{ $chineseData.character.title }}</h3>
          <div class="character-sections">
            {{ if $chineseData.character.temperament }}
            <div class="character-section">
              <h4>Temperament</h4>
              <p>{{ $chineseData.character.temperament.description }}</p>
            </div>
            {{ end }}
            {{ if $chineseData.character.cognition }}
            <div class="character-section">
              <h4>Cognition</h4>
              <p>{{ $chineseData.character.cognition.description }}</p>
            </div>
            {{ end }}
            {{ if $chineseData.character.motivation }}
            <div class="character-section">
              <h4>Motivation</h4>
              <p>{{ $chineseData.character.motivation.description }}</p>
            </div>
            {{ end }}
            {{ if $chineseData.character.social_style }}
            <div class="character-section">
              <h4>Social style</h4>
              <p>{{ $chineseData.character.social_style.description }}</p>
            </div>
            {{ end }}
            {{ if $chineseData.character.shadow_patterns }}
            <div class="character-section">
              <h4>Shadow patterns</h4>
              <p>{{ $chineseData.character.shadow_patterns.description }}</p>
            </div>
            {{ end }}
          </div>
        </div>
        {{ end }}

        {{/* Archetype */}}
        {{ if $chineseData.archetype }}
        <div class="chinese-archetype">
          <h3>{{ $chineseData.archetype.title }}</h3>
          <h4>{{ $chineseData.archetype.type }}</h4>
          <p>{{ $chineseData.archetype.description | markdownify }}</p>
        </div>
        {{ end }}
      </div>
    </section>
    {{ end }}

    {{/* Links Section (if exists) */}}
    {{ partial "cards/generic.html" (dict "Page" . "key" "links") }}
  </article>
</div>
{{ end }}
